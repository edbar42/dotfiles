# config function

function y() {
	local tmp="$(mktemp -t "yazi-cwd.XXXXXX")" cwd
	yazi "$@" --cwd-file="$tmp"
	IFS= read -r -d '' cwd < "$tmp"
	[ -n "$cwd" ] && [ "$cwd" != "$PWD" ] && builtin cd -- "$cwd"
	rm -f -- "$tmp"
}

# fzf integration
source <(fzf --zsh)

# zsh plugins
source /usr/share/zsh/plugins/zsh-vi-mode/zsh-vi-mode.plugin.zsh
source /usr/share/zsh/plugins/zsh-autosuggestions/zsh-autosuggestions.plugin.zsh
source /usr/share/zsh/plugins/zsh-syntax-highlighting/zsh-syntax-highlighting.plugin.zsh

# Zoxide as a replacement to cd
eval "$(zoxide init --cmd cd zsh)"

# Manage SSH keys
eval $(keychain -q --eval $HOME/personal/auth/ssh/git)

# Activate mise-en-place
eval "$(mise activate zsh)"

# starship prompt
eval "$(starship init zsh)"

# fzf integration

# Proper key mappings (HyperX Alloy Origins 60)
bindkey '^[[3' prefix-2
bindkey '^[[3~' delete-char
bindkey '^[[H' beginning-of-line
bindkey '^[[F' end-of-line

autoload -Uz compinit && compinit

# ----------------------------- ALIASES -----------------------------------
# Base aliases
alias rm="rm -Iv"
alias cp="cp -irv"
alias mv="mv -iv"
alias mkdir="mkdir -pv"
alias vim="nvim"

# Colors
alias diff="diff --color=auto"
alias ip="ip --color=auto"
alias bat="bat --theme='TwoDark' --color=always"

# Terminal tools
alias ls="eza --icons"
alias ld="eza -D --icons"
alias la="eza -a --icons --git"
alias ll="eza -lh --icons --git"
alias lla="eza -lah --icons --git"
alias lt="eza --tree --icons"
alias vim="nvim -u NONE"
alias lzd="oxker"

# Chezmoi alias
alias ccd="chezmoi cd"
alias tidy="chezmoi apply"
alias cadd="chezmoi add"

# Go aliases
alias gotst="go test -v -cover ./..."

# Wezterm image viewer
alias see="wezterm imgcat"

alias fix-mirrors="sudo reflector -c BR,CL,MX,US --protocol https --sort score --latest 10 --save /etc/pacman.d/mirrorlist"

# ------------------------ STARTUP CALLS --------------------------
export LIBVA_DRIVER_NAME=nvidia
export XDG_SESSION_TYPE=wayland
export GBM_BACKEND=nvidia-drm
export __GLX_VENDOR_LIBRARY_NAME=nvidia
export WLR_NO_HARDWARE_CURSORS=1

# Use nvim for everything
export EDITOR="nvim"
export VISUAL="nvim"
export MANPAGER="nvim +Man!"

export PATH="$PATH:$HOME/.bin:$HOME/go/bin/:$PNPM_HOME:$HOME/.local/bin"

#THIS MUST BE AT THE END OF THE FILE FOR SDKMAN TO WORK!!!
export SDKMAN_DIR="$HOME/.sdkman"
[[ -s "$HOME/.sdkman/bin/sdkman-init.sh" ]] && source "$HOME/.sdkman/bin/sdkman-init.sh"
